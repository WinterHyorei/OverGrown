<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Overgrown — Ingest</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #0b0e0c;
    color: #cfe6d3;
    font-family: monospace;
    height: 100%;
    overflow: hidden;
  }

  .container {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .panel {
    text-align: center;
    max-width: 440px;
    padding: 26px;
    border: 1px solid rgba(180, 255, 200, 0.18);
    background: rgba(10, 20, 14, 0.88);
    box-shadow: 0 0 40px rgba(120, 200, 160, 0.1);
  }

  .status {
    opacity: 0.85;
    margin-bottom: 14px;
  }

  .code {
    font-size: 1.8rem;
    letter-spacing: 0.28em;
    margin: 18px 0;
    color: #b6ffd2;
    text-shadow: 0 0 10px rgba(160, 255, 200, 0.45);
    user-select: all;
  }

  button {
    margin-top: 10px;
    padding: 8px 14px;
    font-family: monospace;
    font-size: 0.85rem;
    color: #0b0e0c;
    background: #b6ffd2;
    border: none;
    cursor: pointer;
  }

  button:active {
    transform: scale(0.97);
  }

  .countdown {
    margin-top: 16px;
    font-size: 0.8rem;
    opacity: 0.6;
  }
</style>
</head>
<body>

<div class="container">
  <div class="panel">
    <div class="status" id="status">
      Embedded signature detected.
    </div>

    <div class="code" id="code">
      — — — — —
    </div>

    <button id="copyBtn">COPY FRAGMENT</button>

    <div class="countdown" id="countdown">
      Redirecting to terminal in 10 seconds…
    </div>
  </div>
</div>

<script>
  // -------------------------------
  // CONFIG
  // -------------------------------
  const REDIRECT_URL = "https://winterhyorei.github.io/OverGrown/#terminal";
  const REDIRECT_TIME = 10; // seconds

  // -------------------------------
  // UTILITIES
  // -------------------------------
  function generateFragmentCode() {
    const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
    let out = "";
    for (let i = 0; i < 6; i++) {
      out += chars[Math.floor(Math.random() * chars.length)];
    }
    return out.slice(0, 3) + "-" + out.slice(3);
  }

  // -------------------------------
  // MAIN
  // -------------------------------
  const params = new URLSearchParams(window.location.search);
  const artifactId = params.get("artifact");

  const codeEl = document.getElementById("code");
  const statusEl = document.getElementById("status");
  const countdownEl = document.getElementById("countdown");
  const copyBtn = document.getElementById("copyBtn");

  let fragmentCode = null;

  if (!artifactId) {
    statusEl.textContent = "No artifact signature found.";
    codeEl.textContent = "INVALID";
    copyBtn.style.display = "none";
    countdownEl.style.display = "none";
  } else {
    fragmentCode = generateFragmentCode();

    sessionStorage.setItem("pending_fragment", JSON.stringify({
      artifact: artifactId,
      code: fragmentCode,
      issued: Date.now()
    }));

    codeEl.textContent = fragmentCode;
    statusEl.textContent = "Fragment extracted from artifact.";
  }

  // Copy to clipboard
  copyBtn.onclick = async () => {
    try {
      await navigator.clipboard.writeText(fragmentCode);
      copyBtn.textContent = "COPIED";
      setTimeout(() => copyBtn.textContent = "COPY FRAGMENT", 1200);
    } catch {
      copyBtn.textContent = "COPY FAILED";
    }
  };

  // Countdown + redirect
  let timeLeft = REDIRECT_TIME;
  const timer = setInterval(() => {
    timeLeft--;
    countdownEl.textContent =
      `Redirecting to terminal in ${timeLeft} second${timeLeft !== 1 ? "s" : ""}…`;

    if (timeLeft <= 0) {
      clearInterval(timer);
      window.location.href = REDIRECT_URL;
    }
  }, 1000);
</script>

</body>
</html>
